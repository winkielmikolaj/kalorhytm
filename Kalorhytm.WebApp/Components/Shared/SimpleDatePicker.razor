@* Simple Date Picker Component - Reliable and Easy to Use *@
@namespace Kalorhytm.WebApp.Components.Shared

<div class="w-full bg-white rounded-3xl shadow-lg shadow-slate-200/50 p-6 mb-6 border border-slate-100">
    <div class="flex items-center justify-between gap-4">
        <!-- Previous Day Button -->
        <button @onclick="GoToPreviousDay" 
                class="p-3 rounded-xl bg-slate-50 hover:bg-emerald-50 text-slate-600 hover:text-emerald-600 transition-all border border-slate-200 hover:border-emerald-300">
            <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7"></path>
            </svg>
        </button>

        <!-- Date Display & Picker -->
        <div class="flex-1 text-center">
            <div class="mb-2">
                <input type="date" 
                       value="@SelectedDate.ToString("yyyy-MM-dd")"
                       @onchange="HandleDateChange"
                       @oninput="HandleDateInput"
                       class="text-center text-lg font-bold text-slate-900 bg-transparent border-none outline-none cursor-pointer hover:text-emerald-600 transition-colors" />
            </div>
            <div class="text-sm text-slate-500 font-medium">
                @GetFormattedDate()
            </div>
        </div>

        <!-- Next Day Button -->
        <button @onclick="GoToNextDay" 
                class="p-3 rounded-xl bg-slate-50 hover:bg-emerald-50 text-slate-600 hover:text-emerald-600 transition-all border border-slate-200 hover:border-emerald-300">
            <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"></path>
            </svg>
        </button>

        <!-- Today Button -->
        <button @onclick="GoToToday" 
                class="px-4 py-2 rounded-xl bg-emerald-500 hover:bg-emerald-600 text-white font-semibold text-sm transition-all shadow-sm hover:shadow-md">
            Today
        </button>
    </div>
</div>

@code {
    [Parameter] public DateTime SelectedDate { get; set; } = DateTime.Today;
    [Parameter] public EventCallback<DateTime> SelectedDateChanged { get; set; }

    private async Task GoToPreviousDay()
    {
        SelectedDate = SelectedDate.AddDays(-1);
        await OnDateChanged();
    }

    private async Task GoToNextDay()
    {
        SelectedDate = SelectedDate.AddDays(1);
        await OnDateChanged();
    }

    private async Task GoToToday()
    {
        SelectedDate = DateTime.Today;
        await OnDateChanged();
    }

    private async Task HandleDateChange(ChangeEventArgs e)
    {
        if (e.Value != null && DateTime.TryParse(e.Value.ToString(), out var newDate))
        {
            SelectedDate = newDate.Date;
            await OnDateChanged();
        }
    }

    private async Task HandleDateInput(ChangeEventArgs e)
    {
        // Handle real-time input changes for better UX
        if (e.Value != null && DateTime.TryParse(e.Value.ToString(), out var newDate))
        {
            SelectedDate = newDate.Date;
            await OnDateChanged();
        }
    }

    private async Task OnDateChanged()
    {
        await SelectedDateChanged.InvokeAsync(SelectedDate);
    }

    private string GetFormattedDate()
    {
        if (SelectedDate.Date == DateTime.Today.Date)
            return "Today";
        if (SelectedDate.Date == DateTime.Today.AddDays(-1).Date)
            return "Yesterday";
        if (SelectedDate.Date == DateTime.Today.AddDays(1).Date)
            return "Tomorrow";
        
        return SelectedDate.ToString("dddd, MMMM dd, yyyy", System.Globalization.CultureInfo.InvariantCulture);
    }
}
